<div class="card card-custom gutter-b">
  <ng-container *ngIf="isLoading$ | async">
    <div class="progress progress-modal">
      <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar"
        style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
  </ng-container>

  <div class="card-header">
    <div class="card-title">
      <!-- <h3 class="card-label">
        <ng-container *ngIf="product">
          {{ id ? "Edit" : "New" }} product
          <span *ngIf="product && product.id"
            >'{{ product.manufacture }} {{ product.model }} -
            {{ product.modelYear }}'</span
          >
        </ng-container>
        {{ product?.manufacture }}
      </h3> -->
    </div>
    <div class="card-toolbar">
      <a type="button" class="btn btn-danger" routerLink="/ecommerce/products">
        <i class="fa fa-arrow-left"></i>Quay lại
      </a>
      <button class="btn btn-primary ml-2" (click)="reset()">
        <i class="fa fa-redo"></i>Reset
      </button>
    </div>
  </div>
  <div class="card-body">
    <ul class="nav nav-tabs nav-tabs-line" role="tablist">
      <li class="nav-item cursor-pointer" (click)="changeTab(tabs.BASIC_TAB)">
        <a class="nav-link" data-toggle="tab" role="tab" [attr.aria-selected]="activeTabId === tabs.BASIC_TAB"
          [class.active]="activeTabId === tabs.BASIC_TAB">
          Thông tin sản phẩm
        </a>
      </li>
      <li *ngIf="product && product.id" class="nav-item cursor-pointer" (click)="changeTab(tabs.REMARKS_TAB)">
        <a class="nav-link" data-toggle="tab" role="button" [attr.aria-selected]="activeTabId === tabs.REMARKS_TAB"
          [class.active]="activeTabId === tabs.REMARKS_TAB">Product remarks</a>
      </li>
      <li *ngIf="product && product.id" class="nav-item cursor-pointer" (click)="changeTab(tabs.SPECIFICATIONS_TAB)">
        <a class="nav-link" data-toggle="tab" role="tab" [attr.aria-selected]="activeTabId === tabs.SPECIFICATIONS_TAB"
          [class.active]="activeTabId === tabs.SPECIFICATIONS_TAB">Product Images</a>
      </li>
    </ul>

    <ng-container *ngIf="activeTabId === tabs.BASIC_TAB">
      <div class="mt-5" *ngIf="product">
        <form action="#" class="form form-label-right" [formGroup]="formGroup">
          <div class="form-group row">
            <div class="col-lg-4">
              <label>Mã sản phẩm</label>
              <input [attr.disabled]="id ? 'true' : null" type="text"
                class="form-control form-control-lg form-control-solid" style=" background-color: #dcd5d5 !important;"
                autocomplete="off" placeholder="Mã sản phẩm" [class.is-invalid]="isControlInvalid('productCode')"
                [class.is-valid]="isControlValid('productCode')" name="productCode" formControlName="productCode" />
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'productCode')">
                Mã sản phẩm không được bỏ trống
              </div>
            </div>
            <div class="col-lg-4">
              <label>Tên sản phẩm</label>
              <input type="text" class="form-control form-control-lg form-control-solid" autocomplete="off"
                placeholder="Tên sản phẩm" name="productName" formControlName="productName"
                [class.is-invalid]="isControlInvalid('productName')" [class.is-valid]="isControlValid('productName')" />
              <div class="valid-feedback" *ngIf="isControlValid('productName')">
                Tên sản phẩm hợp lệ
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'productName')">
                Tên sản phẩm không được bỏ trống
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('minlength', 'productName')">
                Tên sản phẩm ít nhất 1 ký tự
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('maxLength', 'productName')">
                Tối đa 500 ký tự
              </div>
            </div>
            <div class="col-lg-4">
              <label>Danh mục</label>
              <select class="form-control" name="categoryId" placeholder="Filter by Danh mục"
                [class.is-invalid]="isControlInvalid('categoryId')" [class.is-valid]="isControlValid('categoryId')"
                formControlName="categoryId">
                <ng-container *ngFor="let cate of categories">
                  <option value="{{cate.id}}" selected>{{cate.categoryName}}</option>
                </ng-container>
              </select>
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'categoryId')">
                Danh mục không được bỏ trống
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('min', 'categoryId')">
                Danh mục không được bỏ trống
              </div>
            </div>

          </div>
          <div class="form-group row">
            <div class="col-lg-4">
              <label>Tiêu đề SEO</label>
              <input type="text" class="form-control form-control-lg form-control-solid" autocomplete="off"
                placeholder="Title SEO" name="seoTitle" formControlName="seoTitle"
                [class.is-invalid]="isControlInvalid('seoTitle')" [class.is-valid]="isControlValid('seoTitle')" />
              <div class="valid-feedback" *ngIf="isControlValid('seoTitle')">
                Product Name hợp lệ
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'seoTitle')">
                Tiêu đề bắt buộc
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('minlength', 'seoTitle')">
                Tên sản phẩm ít nhất 1 ký tự
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('maxLength', 'seoTitle')">
                Tối đa 100 ký tự
              </div>
            </div>
            <div class="col-lg-4">
              <label>Giá khuyến mãi</label>
              <input type="number" class="form-control form-control-lg form-control-solid" placeholder="Giá khuyến mãi"
                name="promotionPrice" formControlName="promotionPrice" />

            </div>
            <div class="col-lg-4">
              <label>Giá tiền(VND)</label>
              <input type="number" class="form-control form-control-lg form-control-solid" autocomplete="off"
                placeholder="Giá tiền" name="price" formControlName="price" />
            </div>

          </div>
          <div class="form-group row">
            <div class="col-lg-3">
              <label>Nổi bậc</label>
              <select class="form-control" name="isHot" placeholder="Là sản phẩm nổi bậc" formControlName="isHot">
                <option value="1" selected>Hot</option>
                <option value="0" selected>Không</option>
              </select>
            </div>
            <div class="col-lg-3">
              <label>Số lượng</label>
              <input type="number" class="form-control form-control-lg form-control-solid" name="stock"
                formControlName="stock" [class.is-invalid]="isControlInvalid('stock')"
                [class.is-valid]="isControlValid('stock')" />
              <div class="valid-feedback" *ngIf="isControlValid('stock')">
                Stock không hợp lệ
              </div>
              <div class="valid-feedback" *ngIf="controlHasError('min', 'stock')">
                Lớn hơn 0
              </div>
            </div>
            <div class="col-lg-3">
              <label>Mới</label>
              <select class="form-control" name="isNew" placeholder="Là sản phẩm mới" formControlName="isNew">
                <option value="1" selected>Mới</option>
                <option value="0" selected>Không</option>
              </select>
            </div>
            <div class="col-lg-3">
              <label>Status</label>
              <select class="form-control" name="status" placeholder="Trạng thái sản phẩm" formControlName="status">
                <option value="1" selected>Ẩn</option>
                <option value="0" selected>Đang bán</option>
              </select>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-lg-4">
              <label>Tags (cách dấu phẩy ',')</label>
              <input type="text" class="form-control form-control-lg form-control-solid" autocomplete="off"
                placeholder="Tags " name="productTags" formControlName="productTags" />
            </div>
            <div class="col-lg-4">
              <label>SeoKeyword</label>
              <input class="form-control form-control-lg form-control-solid" name="seoKeyword"
                formControlName="seoKeyword" />
            </div>

            <div class="col-lg-4">
              <label>Bảo hành (tháng)</label>
              <input type="number" class="form-control form-control-lg form-control-solid" name="guarantee"
                formControlName="guarantee" />
            </div>
          </div>

          <div class="form-group row">
            <div class="col-lg-12">
              <label>Thuộc tính sản phẩm</label>
              <table class="table table-head-custom table-vertical-center overflow-hidden">
                <thead>
                  <th>
                    (ID)
                  </th>
                  <th>
                    Tên
                  </th>
                  <th>
                    Thuộc tính - giá trị
                  </th>
                  <th>ACTIONS</th>
                </thead>
                <tbody>
                  <tr *ngFor="let att of product.productAttributes">
                    <td>{{ att.attributeValueID }}</td>
                    <td>{{ att.attributeValueName }}</td>
                    <td>{{ att.attributeName + ' - ' + att.attributeValueName }}</td>
                    <td>
                      <a title="Delete attribute" class="btn btn-icon btn-light btn-hover-danger btn-sm"
                        (click)="removeItemAtt(att.attributeValueID)">
                        <!-- --(click)="delete(product.id)" -->
                        <span [inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'" cacheSVG="true"
                          class="svg-icon svg-icon-md svg-icon-danger">
                        </span>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
              <a type="button" class="btn btn-primary" (click)="addProductAttribute()"><i class="fa fa-plus"
                  aria-hidden="true"></i> Thêm </a>
            </div>
          </div>
          <div class="form-group">
            <label>Seo Description</label>
            <textarea name="seoDescription" class="form-control form-control-solid"
              formControlName="seoDescription"></textarea>
          </div>
          <div class="form-group">
            <label>Nội dung (mô tả ngắn)</label>
            <angular-editor id="content" formControlName="content" style="height: 100px;"
              [config]="config"></angular-editor>
            <!-- <textarea type="textarea" class="form-control form-control-lg form-control-solid" placeholder="content"
              name="content" formControlName="content" style="height: 100px;"></textarea> -->
          </div>
          <div class="form-group">
            <label>Description (mô tả chi tiết)</label>
            <angular-editor id="description" formControlName="description" [config]="config"
              [class.is-invalid]="isControlInvalid('description')"
              [class.is-valid]="isControlValid('description')"></angular-editor>
            <div class="valid-feedback" *ngIf="isControlValid('description')">
              Description hợp lệ
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('required', 'description')">
              Description bắt buộc
            </div>
            <div class="invalid-feedback" *ngIf="controlHasError('maxLength', 'description')">
              Tối đa 4000 ký tự
            </div>

            <!-- <textarea style="height: 200px;" name="description" class="form-control form-control-solid"
              formControlName="description"></textarea> -->
          </div>

          <ng-container *ngIf="!id">
             <h2> <label>Hình ảnh sản phẩm (500x500, cùng kích thước)</label></h2>
            <div class="form-group row">
              <!-- <div class="col-lg-4">
                <label>Sort Order</label>
                <input #sortOrder type="number" class="form-control form-control-lg form-control-solid" name="sortOrder"
                  formControlName="sortOrder" />
              </div>
              <div class="col-lg-6">
                <label>Chọn hình</label>
                <input id="file" type="file" class="form-control" (change)="onFileAdd($event)">
              </div> -->
              <div class="col-lg-2">
                <a type="button" class="btn btn-primary" (click)="addProductImages()"><i class="fa fa-plus"
                    aria-hidden="true"></i> Thêm ảnh</a>
              </div>
            </div>
            <div>
              <table class="table table-head-custom table-vertical-center overflow-hidden">
                <thead>
                  <th>
                    Hình ảnh
                  </th>
                  <th>
                    Sort Order
                  </th>
                  <th>ACTIONS</th>
                </thead>
                <tbody>
                  <tr *ngFor="let att of product.productImages; let i = index">
                    <td>
                      <img id="blah" [src]="att.fileTmpURL" style="max-width: 250px; max-height: 250px;"
                        alt="your image" />
                    </td>
                    <td>{{ att.sortOrder}}</td>
                    <td>
                      <a title="Delete attribute" class="btn btn-icon btn-light btn-hover-danger btn-sm"  (click)="deleteImageAdd(i)" >
                        <span [inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'" cacheSVG="true"
                          class="svg-icon svg-icon-md svg-icon-danger">
                        </span>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </ng-container>

          <div class="float-right">
            <button type="submit" class="btn btn-success font-weight-bold mr-2" (click)="save()">
              Lưu lại
            </button>
            <a class="btn btn-danger font-weight-bold mr-2" routerLink="/ecommerce/products">Thoát</a>
          </div>
        </form>
      </div>
    </ng-container>

    <ng-container *ngIf="activeTabId === tabs.REMARKS_TAB && product && product.id">
      <app-remarks [productId]="product.id"></app-remarks>
    </ng-container>

    <ng-container *ngIf="activeTabId === tabs.SPECIFICATIONS_TAB && product && product.id">
      <app-specifications [productId]="product.id"></app-specifications>
    </ng-container>
  </div>
</div>